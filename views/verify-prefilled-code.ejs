<% include layout/header %>

<div class="container">
  <div class="col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3">
    <h1 class="text-center"><%= __('VERIFY_PREFILLED_CODE_TITLE') %></h1>
    <form id="authorization-form">
      <div>
        <p><%= client_name %> <%= __('VERIFY_MAIN_LABEL_PREFIX') %> <%= domain %><%= __('VERIFY_MAIN_LABEL_SUFFIX') %></p>
      </div>
      <input id="allow-auth" type="button" class="btn btn-success"
        value="<%= __('VERIFY_MAIN_ALLOW_BUTTON') %>">
      <input id="deny-auth" type="button" class="btn btn-danger"
        value="<%= __('VERIFY_MAIN_DENY_BUTTON') %>">
    </form>
  </div>
</div>

<script type="text/javascript">
    (function () {
        var $allowButton = $('#allow-auth');
        var $denyButton = $('#deny-auth');

        var rerender = function(data,status,xhr) {
          var newDoc = document.open("text/html", "replace");
          newDoc.write(data);
          newDoc.close();
        }

        $allowButton.on('click', function (event) {
            event.preventDefault();

            $.ajax({
                url: "<%= link('/verify/allow') %>",
                data: {
                    user_code: '<%= user_code %>',
                    redirect_uri: '<%= redirect_uri %>'
                },
                type: 'POST',
                success: rerender
            });
        });

        $denyButton.on('click', function (event) {
            event.preventDefault();

            $.ajax({
                url: "<%= link('/verify/deny') %>",
                data: {
                    user_code: '<%= user_code %>',
                    redirect_uri: '<%= redirect_uri %>'
                },
                type: 'POST',
                success: rerender
            });
        });
    })();
</script>

<% include layout/foot %>
