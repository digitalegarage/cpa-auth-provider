{
	"info": {
		"_postman_id": "2b910d20-cec2-42a8-8d19-6df04844d90a",
		"name": "CPA Workflow",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Register",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "07b21fd2-6988-4b38-bc39-63e47123ce64",
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"client_id\",jsonData.client_id);",
							"postman.setEnvironmentVariable(\"client_secret\",jsonData.client_secret);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "3e4e0fd7-1dba-45ee-87a3-975f1201ab79",
						"type": "text/javascript",
						"exec": [
							"pm.globals.set(\"idp_port\", \"3000\"); // use \"80\" or \"443\" when needed!",
							"pm.globals.set(\"idp_host\", \"localhost\");",
							"pm.globals.set(\"idp_prefix\", \"\"); // \"idp/\"",
							"pm.globals.set(\"idp_proto\", \"http\");",
							"pm.globals.set(\"cpa_domain\", \"cpa.rts.ch\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"software_id\": \"cpa-test-client\",\n  \"software_version\": \"1.0.0\",\n  \"client_name\": \"My demo test device v1\"\n}"
				},
				"url": {
					"raw": "{{idp_proto}}://{{idp_host}}:{{idp_port}}/{{idp_prefix}}register",
					"protocol": "{{idp_proto}}",
					"host": [
						"{{idp_host}}"
					],
					"port": "{{idp_port}}",
					"path": [
						"{{idp_prefix}}register"
					]
				},
				"description": "Device starts a register process by sending a few information about itself\n"
			},
			"response": []
		},
		{
			"name": "Associate",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "184dcd2f-5a6e-4875-86c1-7958c1099438",
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"device_code\",jsonData.device_code);",
							"postman.setEnvironmentVariable(\"user_code\",jsonData.user_code);",
							"postman.setEnvironmentVariable(\"verification_uri\",jsonData.verification_uri);",
							"postman.setEnvironmentVariable(\"sid2\",postman.getResponseCookie(\"identity.provider.sid2\").value);"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"client_id\": \"{{client_id}}\",\n\t\"client_secret\": \"{{client_secret}}\",\n\t\"domain\": \"{{cpa_domain}}\"\n}"
				},
				"url": {
					"raw": "{{idp_proto}}://{{idp_host}}:{{idp_port}}/{{idp_prefix}}associate",
					"protocol": "{{idp_proto}}",
					"host": [
						"{{idp_host}}"
					],
					"port": "{{idp_port}}",
					"path": [
						"{{idp_prefix}}associate"
					]
				},
				"description": "Device starts a register process by sending a few information about itself\n"
			},
			"response": []
		},
		{
			"name": "Poll",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "9aa41bd7-836d-44b0-aa9f-d914e33b3449",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Cookie",
						"value": "identity.provider.sid2=s%3AppH50pAz1t218iMGvr0ovab6t-6myjkC.q7C9oz%2BJxERe7JpmWf5xtofHkNpcenfJzloMdJWk938"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"client_id\": \"{{client_id}}\",\n\t\"domain\": \"cpa.rts.ch\",\n\t\"device_code\": \"{{device_code}}\",\n\t\"client_secret\": \"{{client_secret}}\",\n\t\"grant_type\": \"http://tech.ebu.ch/cpa/1.0/device_code\"\n}"
				},
				"url": {
					"raw": "{{idp_proto}}://{{idp_host}}:{{idp_port}}/{{idp_prefix}}token",
					"protocol": "{{idp_proto}}",
					"host": [
						"{{idp_host}}"
					],
					"port": "{{idp_port}}",
					"path": [
						"{{idp_prefix}}token"
					]
				},
				"description": "Device starts a register process by sending a few information about itself\n"
			},
			"response": []
		}
	]
}