#!/usr/bin/env node

"use strict";

/**
 * Script to uplift an user to admin privileges
 *
 * Usage: $ bin/make-admin --email=<email>
 */


var db = require('../models');

var EMAIL = '--email=';

var username = undefined;
for (var i in process.argv) {
    if (process.argv[i].startsWith(EMAIL)) {
        username = process.argv[i].slice(EMAIL.length);
        break;
    }
}

if (username) {
    db.User.find({where: {email: username}}).then(
        function (u) {
            if (!u) {
                console.log('user not found:', username);
                return;
            }
            if (u.verified) {
                return u.updateAttributes({permission_id: 1});
            } else {
                console.log('user', u.email, 'has not verified email yet!');
            }
        }
    ).then(
        function (u) {
            if (u) {
                console.log('updated', u.email, 'to have admin permission.');
            } else {
                console.log('no changes were made.');
            }
        }
    ).catch(
        function (e) {
            console.log('Something went wrong:', e);
        }
    );
} else {
    console.log('Usage: bin/make-admin --email=<email>');
}